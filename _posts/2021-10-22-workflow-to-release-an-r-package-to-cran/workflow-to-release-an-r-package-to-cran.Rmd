---
title: "Workflow to release an R package to CRAN"
description: |
  A guide for users of both the GitHub worflow and Gitflow workflow.
author:
  - name: Mauro Lepore
    url: https://github.com/maurolepore
base_url: https://2degreesinvesting.github.io/
date: 2021-10-22
output: 
  distill::distill_article:
    toc: true
    toc_depth: 3
    self_contained: true
categories:
  - r2dii
  - package
  - release
preview: preview.jpg
twitter:
  site: "@mauro_lepore"
  creator: "@mauro_lepore"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>"
)
```

The goal of this post is to help you release an R package to CRAN. It works
whether you use the GitHub workflow or the Gitflow workflow
([video](https://youtu.be/3glCxjn7xnU)).

### Prepare for release

Consider the release of
[maurolepore/releaseworkflow](https://github.com/maurolepore/releaseworkflow)
`v0.0.1`[^1].

[^1]: See Mauro's
[aliases](https://github.com/maurolepore/dotfiles/blob/master/aliases.zsh) under
the section "CRAN release".

* Create a release checklist with `usethis::use_release_issue()`[^2].

[^2]: Ensure your remote `origin` points to the source repo (i.e. your remote setup is "[Ours](https://happygitwithr.com/common-remote-setups.html)"). This will fail if your remote `origin` points elsewhere (e.g. your fork).

* Create a new branch off the default branch[^3] (e.g. `prepare-v0.0.1`) and
follow the release checklist until the end of the section "Prepare for release"
([tweaks](https://github.com/2DegreesInvesting/resources/issues/198)).

[^3]: Usually the default branch is `master` or `main` in the GitHub workflow
and `develop` in the Gitflow workflow.

### Did anything change?

* **Yes** -- the current branch is not ready for release yet:

    * Merge the branch into the default branch and repeat the main steps under
    "Prepare for release" until doing so changes nothing.

* **No** -- the current branch is ready for submission: 

    *  Rename the branch to `v0.0.1`.
    
    *  Increment the version number with `usethis::use_version()`.
    
    *  Submit a release PR into `master` and confirm clean CI.
    
    * `devtools::submit_cran()`. This adds CRAN-RELEASE -- delete it.
    
    * Checkout the default branch and increment the version to `v0.0.1.9000`.
    
    * Continue development on the default branch.
    
### Did CRAN publish the release?

* **No**: Close the release PR into `master`.

* **Yes**: Merge the release PR into `master` and run
`usethis::use_github_release()`[^2] to create a new tag `v0.0.1`[^4] and a
corresponding GitHub release. If you're using the gitflow workflow merge the
branch `v0.0.1` into `develop`.

[^4]: The [`git flow`](https://github.com/nvie/gitflow) extension prompts you to
enter the tag manually. Use the form `vx.y.z` like
`usethis::use_github_release()` does. This avoids tagging the same commit twice.

* Delete the release branch `v0.0.1`.
